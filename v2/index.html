<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>ü¶Ñüí©</title>
    <link href="css/fredoka.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css?v=1743986807">


    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="img/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="img/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="img/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="img/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="img/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon-180x180.png" />

    <link rel="manifest" href="img/site.webmanifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Unicorn Poep">

    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <div id="app">
        <h1 style="view-transition-name: page-title;">ü¶Ñ Unicorn Poep üí©<br>
            <small>Door SchizoDuckie, voor Sanne <img src="img/heart.gif" alt="<3"></small></h1>
        <div id="gameContainer">
            <!-- Loading Indicator -->
            <div id="loading"> <!-- Starts visible -->
                <img src="img/loading.gif" alt="Loading...">
                <h1>Even wat laden, momentje!</h1>
                <!-- Loading Template -->
                <data data-translation-key="loadingDefault">Laden...</data>
            </div>

            <!-- Main Menu & Sheet Selection -->
            <div id="mainMenu" class="hidden">
                 <div id="menuItems" style="view-transition-name: main-content;">
                    <button id="practice">üìö Oefenen</button>
                    <button id="takeTest">‚è± Toets</button>
                    <button id="viewHighscores">ü•á Hoogste Scores</button>
                    <button id="myQuestions">üéí Zelf vragen maken</button>
                    <button id="multiplayer">üë• Samen spelen</button>
                    <button id="hoeDan">ü¶Ñ Wat is Unicorn Poep?</button>
                 </div>
            </div>

            <!-- Sheet Selection (NOW A TOP-LEVEL VIEW) -->
            <div id="sheetSelection" class="hidden">
               <!-- Moved Back Button outside sheetNavigation -->
               <button id="sheetSelectBack" class="backToMain">Terug</button> <!-- Removed hidden class, showView will manage -->

               <div id="sheetsCol" style="view-transition-name: sheets-column;">
                   <h1>Wat wil je doen?</h1>
                   <div id="sheetsCheckboxes">
                       <!-- Checkboxes populated by JS -->
                   </div>
               </div>
               <div id="difficultyCol" class="hidden" style="view-transition-name: difficulty-column;">
                   <h1>Ben je daar goed in?</h1>
                   <div id="difficultySelection">
                       <label><input type="radio" name="difficulty" value="easy"> Denk het niet (‚è± 60)</label>
                       <label><input type="radio" name="difficulty" value="medium" checked> Misschien (‚è± 30)</label>
                       <label><input type="radio" name="difficulty" value="hard"> Zeker wel! (‚è± 5)</label>
                   </div>
               </div>
               <!-- Sheet Navigation NOW ONLY CONTAINS Start Button -->
               <div id="sheetNavigation" style="/* CSS controls positioning */">
                   <button id="startGame" disabled>Start!</button> <!-- No general button class needed if specific style used -->
               </div>
               <data data-translation-key="sheetSelectNoneAvailable">Geen vragenlijsten gevonden.</data>
               <data data-translation-key="sheetSelectLoadError">Fout bij laden vragenlijsten.</data>
            </div>

             <!-- Game Area -->
            <div id="gameArea" class="hidden" style="view-transition-name: main-content;">
                <div id="gameHeader">
                    <!-- NEW: Container for left items -->
                    <div id="gameHeaderLeft">
                        <div id="scoreDisplay">Score: 0</div> 
                        <div id="timerDisplay">00:00</div>
                        <!-- Timer Display Template -->
                        <data id="timerDefault">‚è≥</data> 
                        <!-- NEW: Placeholder for sheet title -->
                        <div id="sheetTitleDisplay">Laden...</div> 
                    </div>
                    <!-- END NEW -->
    
                    <div id="progressIndicator" class=""> <!-- Removed hidden -->
                        <span id="progressText">Vraag 0 / 0</span>
                        <progress id="progressBar" value="0" max="100"></progress>
                        <!-- Progress Display Templates (Already moved, example) -->
                        <data data-translation-key="progressLabel">Vraag</data> 
                    </div>
                    
                    <div id="playerListContainer">
                        <!-- Template for Player List Item (Previously Missing) -->
                        
                    </div> 
                    <template id="player-list-item-template">
                        <div class="opponent-entry" data-peer-id="">
                            <span class="opponent-name"></span>
                            <span class="opponent-score"></span>
                            <span class="opponent-status"></span>
                        </div>
                    </template>
                    <!-- Player list items will be added here by JS -->
                    <!-- Moved Player List Templates -->
                    <data data-translation-key="playerListUnnamed">Naamloos</data>
                    <data data-translation-key="playerListHostTag">(Host)</data>
                    <data data-translation-key="playerListYouTag">(Jij)</data>
                </div>
                <!-- Moved Countdown Template -->
                <data data-translation-key="countdownGo">Go!</data>
                <div id="question">Laden...</div>
                <div id="answers"> 
                </div>
                <div id="gameFeedback"></div> <!-- For confetti, etc. -->
                <div id="gameNavigation">
                    <button id="nextButton" disabled>Volgende</button>
                    <button id="stopGame" class="button danger">Stop</button>
                </div>
                <template id="player-list-item-template">
                            <div class="opponent-entry" data-peer-id="">
                                <span class="opponent-name"></span>
                                <span class="opponent-score"></span>
                                <span class="opponent-status"></span>
                            </div>
                        </template>
                        <!-- Player list items will be added here by JS -->
                        <!-- Moved Player List Templates -->
                        <data data-translation-key="playerListUnnamed">Naamloos</data>
                        <data data-translation-key="playerListHostTag">(Host)</data>
                        <data data-translation-key="playerListYouTag">(Jij)</data>
                <!-- Moved QuizEngine Templates -->
                <data data-translation-key="qeLoading">Vragen laden...</data>
                <data data-translation-key="qeLoadError">Kon vragen niet laden.</data>
            </div>

            <!-- Multiplayer Choice Screen -->
            <div id="multiplayerChoice" class="unicorn-theme hidden" >
                <button class="backToMain">Terug</button>
                <h2>Samen spelen</h2>
                <!-- RESTORED Name Input Container -->
                <div class="name-input-container mb-4">
                    <label for="playerNameInput" class="block mb-1">Jouw naam:</label>
                    <!-- ADDED Wrapper Div for Input + Button -->
                    <div class="input-with-button"> 
                        <input type="text" id="playerNameInput" placeholder="Typ je naam..." class="w-full p-2 rounded bg-white bg-opacity-20 focus:outline-none focus:ring-2 focus:ring-pink-400">
                        <!-- ADDED Refresh Button -->
                        <button id="refreshPlayerNameButton" class="refresh-name-button" title="Genereer willekeurige naam">üîÑ</button>
                    </div>
                     <p id="choiceError" class="text-red-400 text-sm mt-1 hidden"></p> <!-- Adjusted error display -->
                </div>
                
                <!-- Difficulty Selection -->
                <div class="difficulty-selection-mp">
                    <h3>Kies Moeilijkheidsgraad:</h3>
                    <label>
                        <input type="radio" name="mpDifficulty" value="easy">
                        Makkelijk
                    </label>
                    <label>
                        <input type="radio" name="mpDifficulty" value="medium" checked>
                        Gemiddeld
                    </label>
                    <label>
                        <input type="radio" name="mpDifficulty" value="hard">
                        Moeilijk
                    </label>
                </div>

                
                <button id="hostGame" class="button primary">Maak een spel aan</button>
                <button id="joinGame" class="button secondary">Doe mee met een spel</button>
            
                <!-- Multiplayer Choice Templates -->
                <data data-translation-key="mpChoiceErrorEmptyName">Vul alsjeblieft een naam in.</data>
                <data data-translation-key="mpChoiceErrorNameTooLong">Naam mag maximaal 40 tekens lang zijn.</data>
            </div>

            <!-- Multiplayer Connection Status Dialog -->
            <dialog id="connectionStatus" class="hidden">
                <button class="backToMain">Terug</button>
                <h2>Samen spelen</h2>

                <!-- Host View -->
                <div id="connectionCode" class="unicorn-theme hidden host-view"> <!-- Added host-view class for clarity -->
                    <!-- Removed host-lobby-content wrapper -->
                    <!-- Removed Left Column wrapper -->
                    <div class="host-lobby-section code-section"> <!-- Removed inline style -->
                        <p class="help-text">Deel deze code met de andere speler:</p>
                        <div class="host-code-wrapper">
                            <span id="hostCodeDisplay" class="host-code-text">Laden...</span>
                            <button id="copyCodeButton" class="copy-button" title="Kopieer code">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0z" fill="none"/><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            </button>
                            <a id="whatsappShareButton" class="share-button whatsapp-button" href="#" target="_blank" title="Deel via WhatsApp" data-whatsapp-url="" data-share-text="Doe mee met mijn Unicorn Poep spel! Klik hier:">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                            </a>
                        </div>

                        <p class="help-text">Of deel deze directe link:</p>
                        <div class="host-code-wrapper">
                            <span id="hostJoinLinkDisplay" class="host-code-text join-link-text">Laden...</span>
                            <button id="copyJoinLinkButton" class="copy-button" title="Kopieer link">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0z" fill="none"/><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Player List Section -->
                    <div class="host-lobby-section player-list-section"> <!-- Removed inline style -->
                        <p id="hostWaitingText" class="waitingText">
                            <span id="host-status-initializing" class="host-status hidden" data-translation-key="host-status-initializing">Host initialiseren...</span>
                            <span id="host-status-waiting" class="host-status hidden">
                                <span id="playerCount" class="font-bold text-xl">0</span>
                                <span id="playerLabelSingular"> andere speler</span><span id="playerLabelPlural" class="hidden"> andere spelers</span> verbonden.
                            </span>
                        </p>
                        <!-- Player names list container -->
                        <div id="hostPlayerListContainer" class="player-list-container">
                            <ul id="hostPlayerList" class="player-list"></ul>
                            <p id="hostPlayerListPlaceholder" class="italic text-gray-400">Nog geen andere spelers...</p> 
                        </div>
                    </div>
                    
                    <!-- Start Button Section -->
                    <div class="host-lobby-section start-section"> <!-- Removed inline style -->
                        <p class="help-text mb-2">Start het spel wanneer je klaar bent!</p>
                        <button id="hostStartButton" class="menuButton yellow-button hidden">Start Spel!</button>
                    </div>

                    <!-- Error Display -->
                    <div id="hostErrorDisplay" class="error-message hidden"></div> <!-- Removed inline style -->

                    <!-- Host Lobby Templates (General) -->
                    <data data-translation-key="hostLoading">Laden...</data>
                    <data data-translation-key="hostWhatsappShare">Doe mee met mijn Unicorn Poep spel! Klik hier:</data>
                     <data data-translation-key="hostLobbyErrorCode">Fout!</data>
                     <data data-translation-key="hostLobbyErrorLink">Link fout!</data>
                     <data data-translation-key="mpHostErrorNoQuestions">Geen vragen geladen voor de geselecteerde lijsten/moeilijkheid.</data>
                     <data data-translation-key="mpHostErrorStartPrefix">Host fout bij starten spel: </data>
                     <data data-translation-key="mpHostErrorNextQPrefix">Host fout: Kon vraagdata niet ophalen voor index </data>

                </div>

                <!-- Client Join View -->
                <div id="joinView" class="connectionBox unicorn-theme hidden">
                    <p id="joinPlayerName" class="help-text" style="font-size: 1.2em; margin-bottom: 20px;" data-welcome-text="Hoi! Iemand heeft je uitgenodigd om Unicorn Poep te spelen! Voer hieronder de code in die je hebt gekregen.">Hoi! Iemand heeft je uitgenodigd om Unicorn Poep te spelen! Voer hieronder de code in die je hebt gekregen.</p>
                    <input type="number" maxlength="6" pattern="[0-9]*" inputmode="numeric" placeholder="Voer 6-cijferige code in" id="connectionCodeInput" data-placeholder-text="Voer 6-cijferige code in">
                    <button id="submitCode" class="menuButton yellow-button" data-button-text="Verbinden">Verbinden</button>
                    <p class="help-text" data-help-text="Vraag de andere speler om de code">Vraag de andere speler om de code</p>
                    <p id="connectionErrorMessage" class="error-message hidden"></p>
                    <!-- Join Lobby Templates (Join View Specific & Errors) -->
                     <data data-translation-key="joinWelcome">Hoi %NAME%! Voer de code in die je van de host hebt gekregen.</data>
                     <data data-translation-key="joinErrorConnectPrefix">Kon niet verbinden: </data>
                     <data data-translation-key="joinErrorInvalidCode">Voer een geldige 6-cijferige code in.</data>
                     <data data-translation-key="joinErrorEmptyName">Vul alsjeblieft je naam in.</data>
                     <data data-translation-key="joinErrorNameTooLong">Naam mag maximaal 40 tekens lang zijn.</data>
                </div>

                <!-- Client Fetching Info View -->
                <div id="fetchingInfoView" class="connectionBox hidden">
                    <p class="waitingText" data-fetching-text="Spel informatie ophalen...">Spel informatie ophalen...</p>
                    <img src="img/loading.gif" alt="Loading..." class="waiting-kirby">
                </div>

                <!-- Client Join Confirmation View -->
                <div id="joinConfirmView" class="connectionBox unicorn-theme hidden join-confirm-grid"> <!-- Added class for grid styling -->
                    <h2 data-confirm-title="Meedoen met spel?" class="join-confirm-title">Meedoen met spel?</h2>
                    
                    <!-- Left Column with Panel -->
                    <div class="host-lobby-section join-confirm-left-panel"> 
                        <p class="help-text panel-title">Spel Details:</p> <!-- Added class -->
                        <div id="joinGameInfo" class="game-info-display"> 
                            <!-- Game info populated by JS -->
                        </div>
                    </div>

                    <!-- Right Column with Panel -->
                    <div class="host-lobby-section join-confirm-right-panel"> 
                        <div class="name-input-container"> 
                            <label for="joinConfirmPlayerNameInput" data-name-label="Jouw Naam:" class="help-text">Jouw Naam:</label> 
                            <!-- ADDED Wrapper Div for Input + Button -->
                            <div class="input-with-button">
                                <input type="text" id="joinConfirmPlayerNameInput" placeholder="Naam" data-name-placeholder="Naam" required>
                                <!-- ADDED Refresh Button -->
                                <button id="refreshJoinConfirmNameButton" class="refresh-name-button" title="Genereer willekeurige naam">üîÑ</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dialog-buttons join-confirm-buttons"> 
                        <button id="confirmJoinButton" class="menuButton green-button" data-confirm-button="Ja, doe mee!">Ja, doe mee!</button>
                        <button id="cancelJoinButton" class="menuButton red-button" data-cancel-button="Annuleren">Annuleren</button>
                    </div>
                    
                    <!-- Join Lobby Templates (Confirm View Specific & Fallbacks) -->
                    <data data-translation-key="joinDefaultPlayerName">Player</data>
                    <data data-translation-key="joinInfoUnknown">Unknown</data>
                    <data data-translation-key="joinInfoDefaultHost">Host</data>
                    <data data-translation-key="joinInfoDefaultSheets">Default</data>
                    <data data-translation-key="joinInfoDefaultDifficulty">Medium</data>
                </div>

                <!-- Client Waiting For Start View -->
                <div id="waitingForStartView" class="connectionBox hidden">
                     <p class="waitingText" data-waiting-text="Verbonden! Wachten tot host het spel start...">Verbonden! Wachten tot host het spel start...</p>
                     <img src="img/loading.gif" alt="Waiting..." class="waiting-kirby">
                 </div>

                 <!-- Error Message Display Area -->
                 <p id="connectionErrorMessage" class="hidden"></p>
                 <!-- Multiplayer Client Manager Fallback Templates (Attach to dialog level) -->
                 <data data-translation-key="mcDisconnect">Disconnected from host.</data>
                 <data data-translation-key="mcDefaultPlayerName">Unknown</data>

            </dialog> <!-- End #connectionStatus Dialog -->

            <!-- Highscores Screen -->
            <div id="highscores" class="hidden" style="view-transition-name: main-content;">
                <h1>Deze mensen zijn de allerbeste!</h1>
                <table>
                    <thead>
                    <tr>
                        <th>Plek</th>
                        <th>Spel</th>
                        <th>Naam</th>
                        <th>Score</th>
                        <th>Datum</th>          
                    </tr></thead>
                    <tbody id="scoreList"></tbody>
                </table>
                <!-- Template for a single high score row -->
                <template id="highscore-row-template">
                    <tr>
                        <td class="rank"></td>
                        <td class="game-name"></td>
                        <td class="name"></td>
                        <td class="score"></td>
                        <td class="date" style="white-space: nowrap;"></td>
                    </tr>
                </template>
                <div>
                    <button class="backToMain">Terug</button>
                </div>
                <!-- Highscores Templates -->
                <data data-translation-key="hsLoadErrorDefault">Kon scores niet laden.</data>
                <data data-translation-key="hsRenderErrorPrefix">Fout: </data>
                <data data-translation-key="hsListEmpty">De Highscores lijst is nog leeg... Jouw naam kan hier staan!</data>
                <data data-translation-key="hsLoadError">Could not load high scores.</data>
                <data data-translation-key="hsDefaultPlayerName">Player</data>
            </div>

            <!-- Custom Questions Screen -->
            <div id="customQuestionsManager" class="hidden" style="view-transition-name: main-content;">
                <button class="backToMain">Terug</button>
                 <h2>Jouw Vragen Beheren</h2>
                <div id="customSheetSelection">
                    <div id="customSheetsCol">
                        <h3>Nieuwe lijst / Bewerken:</h3>
                        <div id="customQuestionsInput">
                            <input type="text" id="customSheetName" placeholder="Naam van je vragenlijst">
                            <textarea id="customQuestionsTextarea" rows="10" placeholder="Typ je vragen hier. Elke vraag + antwoord op een nieuwe regel. Zorg dat er ' => ' tussen vraag en antwoord staat. Voorbeeld: Hoeveel is 2 x 2? => 4"></textarea>
                            <button id="saveCustomQuestionsButton">Opslaan</button>
                        </div>
                    </div>
                    <div id="customDifficultyCol">
                        <h3>Bestaande lijsten:</h3>
                        <div id="customDifficultySelection">
                            <select id="existingCustomQuestions">
                                <option value="">-- Nieuwe lijst maken --</option>
                            </select>
                            <button id="editCustomQuestionsButton">Bewerken</button>
                            <button id="deleteCustomQuestionsButton">Verwijderen</button>
                        </div>
                         <!-- List container for existing sheets -->
                         <div id="customSheetList">
                            <template id="custom-sheet-item-template">
                                <li class="custom-sheet-item" data-sheet-id="">
                                    <span class="sheet-name">Sheet Name</span>
                                    <span class="sheet-actions">
                                        <button class="edit-button" title="Bewerk deze lijst">Bewerk</button>
                                        <button class="delete-button warn" title="Verwijder deze lijst">Verwijder</button>
                                    </span>
                                </li>
                            </template>
                            <!-- Custom sheets will be loaded here -->
                         </div>
                    </div>
                </div>
                <!-- Custom Questions Manager Templates -->
                <data data-translation-key="customQWarnName">Geef je vragenlijst een naam!</data>
                <data data-translation-key="customQWarnQuestion">Voer minstens √©√©n vraag in!</data>
                <data data-translation-key="customQLoadError">Kon eigen vragenlijsten niet laden.</data>
                <data data-translation-key="customQListEmpty">Nog geen eigen vragenlijsten opgeslagen.</data>
                <data data-translation-key="customQListError">Fout bij laden van eigen vragenlijsten.</data>
                <data data-translation-key="customQDeleteFallbackName">deze lijst</data>
                <data data-translation-key="qmDefaultCustomName">Naamloos</data>
                <data data-translation-key="qmSaveError">Kon eigen vragenlijsten niet opslaan.</data>
                <data data-translation-key="qmParseErrorLine">Ongeldig formaat op regel %LINE%: '%CONTENT%'. Verwacht 'vraag => antwoord'.</data>
                 <!-- Moved Sheet Selection errors here as they relate to custom sheets mostly -->
            </div>

            <!-- About Screen -->
            <div id="about" class="hidden" style="view-transition-name: main-content;">
                <button class="backToMain">Terug</button>
                <h2>Wat is Unicorn Poep?</h2>
                <p>Unicorn Poep is een heel simpel spelletje wat je helpt snel beter te worden in de tafels,
                    woordjes, en andere dingen die je moet onthouden voor school.</p>
                <h3>Hoe speel je het spel?</h3>
                <p>Het is heel eenvoudig! <br>
                    Wanneer je het spel start, zie je vragen met een paar antwoorden.<br>
                    Jouw taak is om het juiste antwoord te kiezen.<br>
                    Als je het goed hebt, zie je confetti üéâ en krijg je punten.<br>
                    Hoe sneller je bent, hoe meer punten je krijgt!<br>
                    Als je het fout hebt zie je üòø maar OOK het goede antwoord in groen,<br> goed onthouden voor de volgende keer dus!
                </p>
                <h3>Oefenen of een Examen</h3>
                <p>Je kan kiezen om te oefenen of om een toets te doen die kijkt hoe goed je bent.<br>
                    Bij oefenen is er geen tijdslimiet, dus je kunt rustig nadenken.<br>
                    Bij de toets moet je snel zijn en voor elke vraag punten verzamelen.<br>
                    Hoe meer punten je haalt, hoe hoger je naam op de lijst van Hoogste Scores komt!
                </p>
                <h3>Maak je eigen vragen</h3>
                <p>Weet je alle tafels al uit je hoofd? Je kan Unicorn Poep blijven gebruiken door je eigen vragen spelletje maken van alles wat je moet leren!<br>
                    Klik op 'Mijn Vragen' en type je vragen in het grote vak.<br>
                    Type een nieuwe vraag op elke regel, daarna <em>=></em> en daarna het antwoord.<br>
                    Elke vraag + antwoord moet dus op een eigen regel!
                    Bijvoorbeeld:
                </p>
                    <code>
                    Hoeveel is 1 + 1? => 2<br>
                    Wat smeer je op je boterham? => Unicornpoep<br>
                    Wat voor kleur is unicornpoep? => Regenboog
                    </code>
                <p> Je kan ook een naam geven aan je vragenlijst.<br>
                    Zo kun je altijd terugkomen en jouw eigen spelletjes spelen.</p>
                <h3>Veel plezier!</h3>
                <p>Veel plezier met het spelen van Unicorn Poep.<br> Vergeet niet, elke keer dat je speelt word je weer beter dan de vorige keer!</p>
            </div>

        </div> <!-- End #gameContainer -->

         <!-- Dialogs (visibility controlled by JS showModal/close) -->
         <dialog id="endOfGameDialog" class="unicorn-theme hidden">
            <h1>Goed gedaan!</h1>
            <p>Je score is: <strong id="finalScore"></strong>!</p>
            <div>
                <label for="playerName">Jouw naam (voor scorelijst):</label>
                <div class="input-with-button">
                    <input type="text" id="playerName" placeholder="Typ hier...">
                    <button id="refreshNameButton" class="refresh-name-button" title="Genereer willekeurige naam">üîÑ</button>
                </div>
            </div>
            <div id="endGameButtons">
                <button id="saveHighscore">Opslaan</button>
                <button id="restartGame">Opnieuw</button>
                <!-- NOTE: Leaving menuButton class here as it's an action within the dialog, not strictly a 'back' navigation -->
                <button id="spEndMenuButton" class="backToMain menuButton">Hoofdmenu</button>
            </div>
            <!-- Moved Single Player End Templates -->
            <data data-translation-key="spEndErrorSaveName">Vul een naam in!</data>
         </dialog>

         <dialog id="disconnectionDialog" class="unicorn-theme hidden">
             <h2>Verbinding Verbroken</h2>
             <p class="dialog-message">Verbinding verbroken.</p>
             <button id="disconnectionOkButton" class="button primary">OK</button>
             <!-- Disconnection Dialog Templates -->
             <data data-translation-key="disconnectDefault">De andere speler heeft de verbinding verbroken.</data>
         </dialog>

         <!-- Corrected Name Prompt Dialog (Matching Multiplayer Input Pattern) -->
         <dialog id="namePromptDialog" class="unicorn-theme hidden">
             <h2>Hoe heet je?</h2>
             <input type="text" id="namePromptInput" placeholder="Naam...">
             <p id="nameError" class="error-message hidden"></p>
             <button id="namePromptConfirm">Ok</button>
         </dialog>

         <dialog id="errorDialog" class="unicorn-theme hidden">
             <h2 class="dialog-title">Fout</h2>
             <p class="dialog-message">Er is een onbekende fout opgetreden.</p>
             <button class="dialog-close-button" data-dialog-close>OK</button>
         </dialog>

         <!-- New Multiplayer End Results Dialog -->
         <dialog id="multiplayerEndDialog" class="dialog unicorn-theme hidden">
             <h2 id="multiplayerEndTitle">Spel Voorbij!</h2>
             <div id="multiplayerEndResults">
                 <!-- Added list container and template -->
                 <table id="mpResultsTable">
                     <thead>
                         <tr>
                             <th>Plek</th>
                             <th>Naam</th>
                             <th>Score</th>
                         </tr>
                     </thead>
                     <tbody id="mpResultsList">
                         <!-- Results populated by JS -->
                     </tbody>
                 </table>
                 <template id="mp-results-row-template">
                     <tr>
                         <td class="rank"></td>
                         <td class="name"></td>
                         <td class="score"></td>
                     </tr>
                 </template>
                 <!-- End added elements -->
             </div>
             <!-- Add Play Again Button -->
             <button id="mpPlayAgainButton" class="menuButton green-button">Play Again</button> 
             <button id="mpReturnToMenuButton" class="menuButton yellow-button">Hoofdmenu</button> <!-- Renamed button ID -->
             <!-- Moved Multiplayer End Templates -->
             <data data-translation-key="mpEndDefaultPlayerName">Unknown</data>
             <data data-translation-key="mpEndLoadError">Kon resultaten niet laden.</data>
             <data data-translation-key="mpEndNoData">Geen spelers gevonden.</data>
         </dialog>

         <!-- New Practice End Dialog HTML -->
         <dialog id="practiceEndDialog" class="unicorn-theme hidden">
            <div class="dialog-container">
                <h2 class="dialog-title">Oefening Klaar!</h2>
                <div class="dialog-content content">
                    <p>Lekker bezig met oefenen! Denk je dat je klaar bent voor een toets?</p>
                </div>
                <div class="dialog-buttons buttons">
                    <button id="practiceTryAgainButton" class="button button-secondary">Probeer Opnieuw</button> 
                    <button id="practiceMenuButton" class="button button-primary">Hoofdmenu</button>
                </div>
            </div>
         </dialog>

         <!-- New Confirmation Dialog -->
         <dialog id="confirmationDialog" class="unicorn-theme">
             <h2 id="confirmationTitle">Bevestigen</h2>
             <p class="dialog-message">Weet je het zeker?</p>
             <div class="dialog-actions"> 
                 <button id="cancelButton" class="button secondary">Nee</button>
                 <button id="confirmButton" class="button primary">Ja</button>
             </div>
             <!-- Moved Confirmation Dialog Templates -->
             <data data-translation-key="confirmDefaultTitle">Bevestiging</data>
             <data data-translation-key="confirmDefaultOk">Ok</data>
             <data data-translation-key="confirmDefaultCancel">Annuleren</data>
             <data data-translation-key="deleteSheetTitle">Lijst Verwijderen?</data>
             <data data-translation-key="deleteSheetMessage">Weet je zeker dat je de lijst '%NAME%' wilt verwijderen? Dit kan niet ongedaan worden gemaakt.</data>
             <data data-translation-key="deleteSheetOk">Verwijder</data>
             <data data-translation-key="deleteSheetCancel">Annuleren</data>
         </dialog>

         <!-- START Waiting Dialog -->
         <dialog id="waitingDialog" class="dialog unicorn-theme">
           <div class="dialog-content text-center"> <!-- Added text-center -->
             <!-- Title using translation key -->
             <h2 data-translation-key="waitingDialogTitle" class="text-2xl font-bold mb-4">Duurt Lang...</h2>

             <!-- Message using translation key - CORRECTED CLASS -->
             <p class="dialog-message" data-translation-key="waitingDialogDefaultMsg">Even geduld, de baas van het spel gaat zo beginnen!</p> <!-- Changed id="waitingMessage" class="mb-4" to class="dialog-message" -->

             <!-- Cute animated unicorn/poop image -->
             <img src="img/loading.gif" alt="Wachten..." class="mx-auto my-4 h-20 w-20"> <!-- Use your loading gif -->

             <!-- Optional: Spinner (if the gif isn't animated) -->
             <!-- <div class="spinner" style="margin: 1em auto; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--color-accent); border-radius: 50%; animation: spin 1s linear infinite;"></div> -->

             <!-- Optional: Add a cancel button if needed later, with translation -->
             <!--
             <button id="cancelWaitingButton" class="button secondary mt-4" data-translation-key="waitingDialogCancel">Annuleren</button>
             -->
           </div>
         </dialog>
         <!-- END Waiting Dialog -->

         <!-- START Multiplayer Lobby Dialog -->
         <dialog id="multiplayerLobbyDialog" class="dialog unicorn-theme hidden">
             <h2 class="dialog-title">Lobby</h2> <!-- Assuming title class -->
             <p id="lobbyStatusText" class="dialog-status">Wachten...</p> <!-- Added status text -->
             <ul id="lobbyPlayerList" class="player-list"></ul> <!-- Added player list UL -->
             <div class="dialog-actions">
                  <!-- Add the standard back button -->
                  <button class="backToMain button">Terug</button> 
                  <!-- <button id="lobbyLeaveButton" class="button danger">Verlaat Lobby</button> --> <!-- Removed leave button -->
             </div>
              <!-- Lobby Dialog Templates -->
              <data data-translation-key="lobbyWaitingForHost">Wachten tot host spel start...</data>
              <data data-translation-key="lobbyWaitingForPlayers">Wachten op spelers...</data>
              <!-- Template for player item in lobby - CORRECTED ID -->
              <template id="lobby-player-item-template"> <!-- Corrected ID -->
                  <li class="lobby-player-item" data-peer-id="">
                      <span class="lobby-player-name"></span>
                      <span class="lobby-player-tags"></span>
                  </li>
              </template>
         </dialog>
         <!-- END Multiplayer Lobby Dialog -->

         <!-- Add spinner CSS if you choose to use the div spinner -->
         <style>
         @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
         }
         </style>

         <!-- Toast Notification Area -->
         <div id="toastNotification" class="hidden">
             <span id="toastMessage"></span>
             <!-- Moved Toast/Feedback Templates -->
             <data data-translation-key="hostCopyCodeSuccess">Code gekopieerd!</data>
             <data data-translation-key="hostCopyCodeError">Kopi√´ren mislukt</data>
             <data data-translation-key="hostCopyLinkSuccess">Link gekopieerd!</data>
             <data data-translation-key="hostCopyLinkError">Kopi√´ren mislukt</data>
             <data data-translation-key="easterEggActivated">ü¶Ñüí© Easter Egg Activated! ü•≥ Click around!</data>
             <data data-translation-key="coordSaveSuccess">Vragenlijst '%NAME%' opgeslagen.</data>
             <data data-translation-key="coordSaveErrorDefault">Onbekende fout bij opslaan vragenlijst.</data>
             <data data-translation-key="coordSaveErrorFeedback">Fout bij opslaan '%NAME%'.</data>
             <data data-translation-key="coordDeleteSuccess">Vragenlijst verwijderd.</data>
             <data data-translation-key="coordDeleteErrorDefault">Onbekende fout bij verwijderen vragenlijst.</data>
             <data data-translation-key="coordDeleteErrorFeedback">Fout bij verwijderen vragenlijst.</data>
             <data data-translation-key="coordEditLoadErrorFeedback">Fout bij laden van vragenlijst voor bewerken.</data>
             <data data-translation-key="mpHostPlayerLeft">%PLAYER_NAME% heeft het spel verlaten.</data>
             <data data-translation-key="hsLoadErrorFeedback">Error loading high scores.</data>
             <data data-translation-key="hsSaveError">Could not save high score.</data>
         </div>

        <!-- Moved Global/RTC Templates (Place near top of #app or body) -->
        <data data-translation-key="rtcErrorPeerJSLoad">PeerJS library niet geladen. Multiplayer is niet beschikbaar.</data>

        <!-- Renamed ID to #countdown and added inner #countdownText -->
        <div id="countdown" class="hidden">
            <span id="countdownText">5</span> 
        </div>

    </div> <!-- End #app -->

    <script src="js/lib/peerjs.min.js"></script>
    
    <script src="js/lib/confetti.js"></script>

    <!-- V2 Application Entry Point (Module) -->
    <script type="module" src="js/UnicornPoep.js"></script>

    <!-- Analytics -->
    <script data-goatcounter="https://unicornpoep.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

    <div id="text-templates" style="display: none;">
        <!-- ... existing templates ... -->
        
        <data data-translation-key="timerDefault">‚è≥</data> 
        <data data-translation-key="hostLoading">Laden...</data> 
        <data data-translation-key="errorDialogHostUnavailable">Oeps! Kon het spelletje niet vinden. Misschien is de code niet goed, of is de ander al gestopt?</data>
        <data data-translation-key="errorDialogNetwork">Oeps! Er is iets mis met het internet. Probeert het later opnieuw!</data>
        <data data-translation-key="errorDialogGenericConnection">Oeps! Er ging iets mis met verbinden. Probeer het nog een keer!</data>
        <data data-translation-key="genericInternalError">Er is een onverwachte fout opgetreden. Probeer het opnieuw.</data>
        <data data-translation-key="gameWarnAlreadyActive">Je bent al in een spel!</data>
        <data data-translation-key="gameErrorStartWhileActive">Kan geen nieuw spel starten, er is al een spel actief.</data>
        <data data-translation-key="defaultPlayerName">Speler</data>
        <data data-translation-key="gameErrorHostWhileActive">Kan geen host starten, er is al een spel bezig.</data>
        <data data-translation-key="mpHostErrorInitFail">Kon multiplayer host niet starten.</data>
        <data data-translation-key="mpClientErrorGameStartFail">Kon niet meedoen met spel.</data>
        <data data-translation-key="qmFetchError">Fout bij ophalen vragenlijsten.</data>
        <data data-translation-key="joinInfoUnknown">Onbekend</data>
        <data data-translation-key="joinInfoDefaultHost">Host</data>
        <data data-translation-key="joinInfoDefaultDifficulty">Normaal</data>
        <data data-translation-key="joinInfoNoSheets">N.v.t.</data>
        <data data-translation-key="joinInfoNoSheetsSelected">Geen lijsten geselecteerd</data>
        <data data-translation-key="joinErrorConnectPrefix">Verbindingsfout: </data>
        <data data-translation-key="joinErrorInvalidCode">Ongeldige code (6 cijfers aub).</data>
        <data data-translation-key="joinErrorEmptyName">Naam mag niet leeg zijn.</data>
        <data data-translation-key="joinErrorNameTooLong">Naam mag max 20 karakters.</data>
        <data data-translation-key="joinErrorConnectFail">Kon niet verbinden met host.</data>

        <!-- Waiting Dialog Translations -->
        <data data-translation-key="waitingDialogTitle">Wachten op de Baas...</data>
        <data data-translation-key="waitingDialogDefaultMsg">Even geduld, de baas van het spel gaat zo beginnen!</data>
        <!-- <data data-translation-key="waitingDialogCancel">Annuleren</data> --> <!-- Uncomment if adding cancel button -->

        <data data-translation-key="lobbyReadyTag">[IS ER KLAAR VOOR]</data>

        <!-- ADDED Missing Keys -->
        <data data-translation-key="mpHostWaitOthers">Wachten op andere spelers...</data>
        <data data-translation-key="mpClientWaitOthers">Je bent klaar! Wachten op de andere spelers...</data>
        <data data-translation-key="mpEndDraw">Gelijkspel!</data>
        <data data-translation-key="mpEndWinnerPrefix">%NAME% wint!</data>
        <data data-translation-key="hsSaveErrorInvalidData">Fout bij opslaan: Ongeldige gegevens.</data>
        <data data-translation-key="errorUnexpectedConsole">Onverwachte consolefout opgetreden.</data>
        <!-- END ADDED -->

        <!-- Random name generator word lists -->
        <datalist id="name-adjectives">
            <option value="Glimmende"></option>
            <option value="Regenboog"></option>
            <option value="Sprankelende"></option>
            <option value="Vrolijke"></option>
            <option value="Dappere"></option>
            <option value="Snelle"></option>
            <option value="Slimme"></option>
            <option value="Knetterende"></option>
            <option value="Blitse"></option>
            <option value="Gestoorde"></option>
            <option value="Krankzinnige"></option>
            <option value="Ruftende"></option>
            <option value="Zingende"></option>
            <option value="Idiote"></option>
            <option value="Spugende"></option>
            <option value="Kwakende"></option>
            <option value="Geprakte"></option>
            <option value="Blaffende"></option>
            <option value="Pluizige"></option>
            <option value="Gillende"></option>
            <option value="Magische"></option>
            <option value="Dansende"></option>
            <option value="Stuiterende"></option>
            <option value="Glitterende"></option>
            <option value="Fluisterende"></option>
            <option value="Pruttelende"></option>
            <option value="Smeltende"></option>
            <option value="Verwarde"></option>
            <option value="Hypnotiserende"></option>
            <option value="Onzichtbare"></option>
            <option value="Vliegende"></option>
            <option value="Geheime"></option>
            <option value="Ondeugende"></option>
            <option value="Razende"></option>
            <option value="Stralende"></option>
            <option value="Waggelende"></option>
        </datalist>
        
        <datalist id="name-nouns">
            <option value="Eenhoorn"></option>
            <option value="Drol"></option>
            <option value="Scheet"></option>
            <option value="Banaan"></option>
            <option value="Wolk"></option>
            <option value="Ster"></option>
            <option value="Donut"></option>
            <option value="Muffin"></option>
            <option value="Fee"></option>
            <option value="Kabouter"></option>
            <option value="Pannenkoek"></option>
            <option value="Knakworst"></option>
            <option value="Kroket"></option>
            <option value="Kaassouffl√©"></option>
            <option value="Bamischijf"></option>
            <option value="Bal Gehakt"></option>
            <option value="Regendruppel"></option>
            <option value="Maanstraal"></option>
            <option value="Raket"></option>
            <option value="Sok"></option>
            <option value="Pantoffel"></option>
            <option value="Theepot"></option>
            <option value="Koektrommel"></option>
            <option value="Goudvis"></option>
            <option value="Krekel"></option>
            <option value="Wortel"></option>
            <option value="Pizza"></option>
            <option value="Wafel"></option>
            <option value="Knuffelbeer"></option>
            <option value="Stuiterbal"></option>
            <option value="Laserstraal"></option>
            <option value="Ninja"></option>
            <option value="Piraat"></option>
        </datalist>
    </div>

    <!-- Add more template keys as needed -->
    <data data-translation-key="namePromptTitle">Enter Your Name</data>
    <data data-translation-key="namePromptButton">Join Game</data>
    <data data-translation-key="hostLobbyLinkCopied">Join link copied to clipboard!</data>
    <data data-translation-key="hostLobbyCodeCopied">Host code copied to clipboard!</data> <!-- Added just in case -->

    <!-- General UI -->
    <data data-translation-key="backButton">Back</data>


    <!-- ADD Basic Styling for the button container -->
    <style>
        .input-with-button {
            display: flex;
            align-items: center;
        }
        .input-with-button input[type="text"] {
            flex-grow: 1;
            /* Optional: Adjust margin if needed */
            /* margin-right: 5px; */ 
        }
        .refresh-name-button {
            background: none;
            border: none;
            font-size: 1.5em; /* Adjust size as needed */
            cursor: pointer;
            padding: 0 5px; /* Add some padding */
            margin-left: 5px; /* Space between input and button */
            line-height: 1; /* Align vertically */
        }
    </style>

</body>
</html>